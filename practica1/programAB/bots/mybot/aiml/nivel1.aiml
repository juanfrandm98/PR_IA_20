<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">

  <!-- INICIO DE CONVERSACIÓN -> QUISIERA UNA CITA -->

  <category>
    <pattern> QUISIERA UNA CITA PARA EL <set>number</set> DE <set>month_es</set></pattern>
    <template>

      <think>

        <!-- Obtenemos la fecha deseada -->
        <set var="dia"><map name="num_dia"><star/></map></set>
        <set var="mes"><map name="num_mes"><star index="2"/></map></set>

        <set name="fecha">
          <get var="dia"/>-<get var="mes"/>-20
        </set>

        <!-- Obtenemos el horario laboral del día deseado -->
        <set var="horario">
          <srai>SUBLIST FROM <srai> ORDINAL 09:00 </srai> TO <srai> ORDINAL 19:00 </srai> OF
            <srai>LIST OF DAY <get name="fecha"/></srai>
          </srai>
        </set>

        <set var="pos">
          <srai>FINDITEM null IN <get var="horario"/></srai>
        </set>

      </think>

      Fecha: <get name="fecha"/>
      Agenda: <get var="horario"/>

      <condition var="pos">
        <li value="0">
          Lo siento, ese día lo tengo completo. ¿Querría otro día?
          <think><set name="topic">dia_ocupado</set></think>
        </li>
        <li>
          <think>
            <set var="item">
              <srai> TOP <get name="horario"/></srai>
            </set>

            <set var="pos">8</set>

            <set name="horas_disponibles"></set>

            <!-- Obtenemos las horas disponibles en el día deseado -->
              <condition var="item">
                <li value="$"></li>
                <li value="null">
                  <set name="horas_disponibles">
                    <get name="horas_disponibles"/> <map name="num_hora"><get var="pos"/></map>
                    <!--<get name="horas_disponibles"/> <srai> ORDINAL <get var="pos"/> </srai>-->
                  </set>
                  <set var="pos">
                    <srai> PLUS <get var="pos"/> 1 </srai>
                  </set>
                  <set var="horario">
                    <srai> REMAIN <get var="horario"/> </srai>
                  </set>
                  <set var="item">
                    <srai> TOP <get var="horario"/></srai>
                  </set>
                  <loop/>
                </li>
                <li>
                  <set var="pos">
                    <srai> PLUS <get var="pos"/> 1 </srai>
                  </set>
                  <set var="horario">
                    <srai> REMAIN <get var="horario"/> </srai>
                  </set>
                  <set var="item">
                    <srai> TOP <get var="horario"/></srai>
                  </set>
                  <loop/>
                </li>
              </condition>
          </think>
          Bien, podría venir a estas horas: <get name="horas_disponibles"/>, ¿le interesa alguna?
          <!--<think><set name="topic">seleccion_hora</set></think>-->
        </li>
      </condition>

    </template>
  </category>

  <category>
    <pattern> Quiero ir el <set>number</set> de <set>month_es</set></pattern>
    <template>
      <srai>QUISIERA UNA CITA PARA EL <star/> DE <star index="2"/></srai>
    </template>
  </category>

  <!-- DÍA OCUPADO, SELECCIÓN DE OTRO? -->

  <topic name="dia_ocupado">

    <category>
      <pattern> Si </pattern>
      <template>
        <think>
          <set name="topic">unknown</set>
        </think>
        Estupendo, ¿qué otra fecha le vendría bien?
      </template>
    </category>

    <category>
      <pattern> ^ no ^ </pattern>
      <template>
        ¡Vuelva cuando quieras!
        <think><set name="topic">unknown</set></think>
      </template>
    </category>

  </topic>

  <!-- DÍA DISPONIBLE, SELECCIÓN DE HORA -->
<!--
  <topic name="seleccion_hora">
  -->
  <category>
    <pattern> A LA+ <set>number</set> </pattern>
    <template>
      <think>
        <set var="hora">
          <srai> ORDINAL <map name="num_hora"><star/></map></srai>
        </set>

        <set var="disponible">
          <srai> IS BUSY DAY <get name="fecha"/> AT <get var="hora"/> </srai>
        </set>
      </think>

      <condition var="disponible">
        <li value="FALSE">
          Hora: <get var="hora"/>
          Perfecto, nos vemos entonces.
          <think>
            <set name="topic">unknown</set>

            <srai>
              MARK OCUPADO AT  <get var="hora"/> ON <get name="fecha"/>
            </srai>
          </think>
        </li>
        <li>
          No, esa hora no está disponible.
        </li>
      </condition>

    </template>
  </category>
    <!--
  </topic>
-->

</aiml>
